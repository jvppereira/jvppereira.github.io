<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Distribui√ß√£o de Verba</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 8px;
            --transition: all 0.2s ease;
        }

        .dark-mode {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
            --primary: #60a5fa;
            --primary-hover: #93c5fd;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.5;
            transition: var(--transition);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .header-left h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header-left p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .verba-total {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            background-color: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
            border: none;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
            border: none;
        }

        .theme-toggle {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-detail {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .badge-success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-danger {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .chart-container:hover {
            box-shadow: var(--shadow-lg);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .table-container {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            overflow: hidden;
        }

        .table-container:hover {
            box-shadow: var(--shadow-lg);
        }

        .search-box {
            margin-bottom: 20px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            padding-left: 40px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            border-bottom: 1px solid var(--border-color);
        }

        th {
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            transition: var(--transition);
        }

        th:hover {
            color: var(--text-primary);
            background-color: rgba(0, 0, 0, 0.02);
        }

        .dark-mode th:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        th i {
            margin-left: 5px;
            font-size: 0.8rem;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        tbody tr {
            transition: var(--transition);
        }

        tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .dark-mode tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .campaign-name {
            font-weight: 500;
        }

        .campaign-value {
            font-weight: 600;
        }

        .campaign-percent {
            font-weight: 600;
            color: var(--primary);
        }

        .table-footer {
            padding-top: 15px;
            font-weight: 700;
            border-top: 2px solid var(--border-color);
        }

        .pie-container {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .pie-container:hover {
            box-shadow: var(--shadow-lg);
        }

        .pie-wrapper {
            position: relative;
            height: 250px;
        }

        .legend {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: var(--radius);
            background-color: rgba(0, 0, 0, 0.02);
            transition: var(--transition);
        }

        .dark-mode .legend-item {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .legend-name {
            flex: 1;
            font-weight: 500;
        }

        .legend-value {
            font-weight: 600;
            margin-left: 10px;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
            margin-top: 30px;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-content {
                gap: 20px;
            }
            
            .chart-wrapper {
                height: 300px;
            }
            
            .pie-wrapper {
                height: 200px;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .controls {
                display: none;
                width: 100%;
                margin-top: 20px;
            }
            
            .controls.active {
                display: flex;
            }
            
            th, td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .header-left h1 {
                font-size: 1.5rem;
            }
            
            .verba-total {
                font-size: 1rem;
                padding: 8px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>Dashboard de Distribui√ß√£o de Verba</h1>
                <p>Monitoramento e an√°lise de aloca√ß√£o de recursos por campanha</p>
            </div>
            
            <div class="verba-total">
                Verba Total: R$ 2.500.000,00
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
            
            <div class="controls" id="controls">
                <button class="btn btn-primary" id="exportJson">
                    <span>üì•</span> Exportar JSON
                </button>
                <button class="btn btn-success" id="exportCsv">
                    <span>üìä</span> Exportar CSV
                </button>
                <button class="btn" id="exportPng">
                    <span>üñºÔ∏è</span> Exportar PNG
                </button>
                <button class="btn" id="copyJson">
                    <span>üìã</span> Copiar JSON
                </button>
                <div class="theme-toggle" id="themeToggle">
                    <span id="themeIcon">üåô</span>
                </div>
            </div>
        </header>
        
        <div class="stats-container">
            <div class="stat-card">
                <h3>Valor Alocado</h3>
                <div class="stat-value" id="valorAlocado">R$ 0,00</div>
                <div class="stat-detail">Soma de todas as campanhas</div>
            </div>
            
            <div class="stat-card">
                <h3>Verba Restante</h3>
                <div class="stat-value" id="verbaRestante">R$ 0,00</div>
                <div class="stat-detail">Diferen√ßa entre verba total e alocada</div>
                <div class="badge" id="statusBadge">Carregando...</div>
            </div>
            
            <div class="stat-card">
                <h3>N√∫mero de Campanhas</h3>
                <div class="stat-value" id="numCampanhas">0</div>
                <div class="stat-detail">Campanhas com verba alocada</div>
            </div>
            
            <div class="stat-card">
                <h3>Percentual M√©dio</h3>
                <div class="stat-value" id="percentualMedio">0%</div>
                <div class="stat-detail">M√©dia percentual das campanhas</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="chart-container">
                <div class="chart-title">
                    <span>Distribui√ß√£o por Campanha (Valor vs Percentual)</span>
                    <span class="chart-subtitle">Barras: Valor (R$) | Linha: Percentual (%)</span>
                </div>
                <div class="chart-wrapper">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="table-container">
                    <div class="chart-title">
                        <span>Detalhes das Campanhas</span>
                        <span id="campaignCount">25 campanhas</span>
                    </div>
                    
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Pesquisar campanhas...">
                    </div>
                    
                    <div class="table-wrapper">
                        <table id="campaignTable">
                            <thead>
                                <tr>
                                    <th data-sort="name">Campanha <i>‚Üì</i></th>
                                    <th data-sort="valor">Valor (R$) <i></i></th>
                                    <th data-sort="percent">Percentual <i></i></th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Dados ser√£o inseridos via JavaScript -->
                            </tbody>
                            <tfoot>
                                <tr class="table-footer">
                                    <td>TOTAL</td>
                                    <td id="tableTotal">R$ 0,00</td>
                                    <td id="tablePercent">100%</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <div class="pie-container">
                    <div class="chart-title">
                        <span>Distribui√ß√£o por Categoria</span>
                    </div>
                    <div class="pie-wrapper">
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="legend" id="pieLegend">
                        <!-- Legenda ser√° inserida via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Dashboard desenvolvido para visualiza√ß√£o de distribui√ß√£o de verba | Dados atualizados em tempo real</p>
        </footer>
    </div>

    <script>
        // Dados embutidos conforme especifica√ß√£o
        const data = {
            "verba_total": 2500000,
            "campaigns": [
                {"name":"SHOW RURAL","valor":50531.64,"percent":"2%"},
                {"name":"REVISTA","valor":28567.95,"percent":"1%"},
                {"name":"COWORKING","valor":13430.79,"percent":"1%"},
                {"name":"ENCIC E PLEN√ÅRIA","valor":10512.36,"percent":"0%"},
                {"name":"APOIO AO SERVIDOR P√öBLICO","valor":13747.68,"percent":"1%"},
                {"name":"PODCAST PODC√äA","valor":19917.42,"percent":"1%"},
                {"name":"CEP","valor":150514.33,"percent":"6%"},
                {"name":"CURSOS E EVENTOS","valor":11591.52,"percent":"0%"},
                {"name":"INSTITUCIONAL","valor":299897.47,"percent":"12%"},
                {"name":"PROEC E ENCONTRO","valor":20941.32,"percent":"1%"},
                {"name":"COMIT√ä MULHERES","valor":49773.54,"percent":"2%"},
                {"name":"CREAJR","valor":96733.76,"percent":"4%"},
                {"name":"PR√äMIO ENEDINA","valor":31272.96,"percent":"1%"},
                {"name":"NOVA SEDE","valor":22095.22,"percent":"1%"},
                {"name":"ARMAZENAGEM DE GR√ÉOS","valor":4912.56,"percent":"0%"},
                {"name":"SEMIN√ÅRIO DE ACESSIBILIDADE","valor":12204.84,"percent":"0%"},
                {"name":"MAIS ENGENHARIA","valor":218922.44,"percent":"9%"},
                {"name":"SELO DE CONFORMIDADE","valor":14641.04,"percent":"1%"},
                {"name":"REDES SOCIAIS","valor":36009.91,"percent":"1%"},
                {"name":"SOEA","valor":76470.84,"percent":"3%"},
                {"name":"F√ìRUM DOCENTES E DISCENTES","valor":81900.02,"percent":"3%"},
                {"name":"DIA DO ENG AGR√îNOMO","valor":143868.86,"percent":"6%"},
                {"name":"EPEC","valor":792307.16,"percent":"32%"},
                {"name":"DIA INTERNACIONAL DA MULHER","valor":49262.82,"percent":"2%"},
                {"name":"AVULSOS","valor":197644.20,"percent":"8%"}
            ],
            "categories":[
                {"name":"MIDIA","percent":24},
                {"name":"PRODU√á√ÉO","percent":46},
                {"name":"CRIA√á√ÉO","percent":31}
            ]
        };

        // Formata√ß√£o de moeda e n√∫meros
        const formatterBRL = new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        });

        const formatterPercent = new Intl.NumberFormat('pt-BR', {
            style: 'percent',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        });

        // Vari√°veis globais
        let barChart, pieChart;
        let currentSort = { column: 'valor', direction: 'desc' };
        let filteredCampaigns = [...data.campaigns];

        // Inicializa√ß√£o da aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeStats();
            renderTable();
            initializeCharts();
            setupEventListeners();
            updateCampaignCount();
        });

        // Inicializar estat√≠sticas
        function initializeStats() {
            const totalValor = data.campaigns.reduce((sum, item) => sum + item.valor, 0);
            const verbaRestante = data.verba_total - totalValor;
            const numCampanhas = data.campaigns.length;
            const percentualMedio = data.campaigns.reduce((sum, item) => {
                const percentNum = parseInt(item.percent) || 0;
                return sum + percentNum;
            }, 0) / numCampanhas;

            document.getElementById('valorAlocado').textContent = formatterBRL.format(totalValor);
            document.getElementById('verbaRestante').textContent = formatterBRL.format(verbaRestante);
            document.getElementById('numCampanhas').textContent = numCampanhas;
            document.getElementById('percentualMedio').textContent = percentualMedio.toFixed(1) + '%';

            // Atualizar badge de status
            const statusBadge = document.getElementById('statusBadge');
            if (verbaRestante > 0) {
                statusBadge.textContent = `Sobram ${formatterBRL.format(verbaRestante)}`;
                statusBadge.className = 'badge badge-success';
            } else if (verbaRestante < 0) {
                statusBadge.textContent = `Excedeu em ${formatterBRL.format(Math.abs(verbaRestante))}`;
                statusBadge.className = 'badge badge-danger';
            } else {
                statusBadge.textContent = 'Verba totalmente alocada';
                statusBadge.className = 'badge';
            }

            // Atualizar total da tabela
            document.getElementById('tableTotal').textContent = formatterBRL.format(totalValor);
            
            // Calcular percentual total (soma dos percentuais)
            const totalPercent = data.campaigns.reduce((sum, item) => {
                const percentNum = parseInt(item.percent) || 0;
                return sum + percentNum;
            }, 0);
            document.getElementById('tablePercent').textContent = totalPercent + '%';
        }

        // Renderizar tabela
        function renderTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            filteredCampaigns.forEach(campaign => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.className = 'campaign-name';
                nameCell.textContent = campaign.name;
                
                const valueCell = document.createElement('td');
                valueCell.className = 'campaign-value';
                valueCell.textContent = formatterBRL.format(campaign.valor);
                
                const percentCell = document.createElement('td');
                percentCell.className = 'campaign-percent';
                percentCell.textContent = campaign.percent;
                
                row.appendChild(nameCell);
                row.appendChild(valueCell);
                row.appendChild(percentCell);
                
                tableBody.appendChild(row);
            });

            updateCampaignCount();
        }

        // Atualizar contador de campanhas
        function updateCampaignCount() {
            const count = filteredCampaigns.length;
            const total = data.campaigns.length;
            document.getElementById('campaignCount').textContent = `${count} de ${total} campanhas`;
        }

        // Inicializar gr√°ficos
        function initializeCharts() {
            // Configura√ß√£o do gr√°fico de barras com linha
            const barCtx = document.getElementById('barChart').getContext('2d');
            
            // Preparar dados
            const campaignNames = filteredCampaigns.map(c => c.name);
            const campaignValues = filteredCampaigns.map(c => c.valor);
            const campaignPercents = filteredCampaigns.map(c => parseInt(c.percent) || 0);
            
            // Destruir gr√°fico anterior se existir
            if (barChart) {
                barChart.destroy();
            }
            
            barChart = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: campaignNames,
                    datasets: [
                        {
                            label: 'Valor (R$)',
                            data: campaignValues,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1,
                            borderRadius: 6,
                            order: 2
                        },
                        {
                            label: 'Percentual (%)',
                            data: campaignPercents,
                            type: 'line',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: 'rgba(239, 68, 68, 1)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 1,
                            fill: true,
                            tension: 0.3,
                            yAxisID: 'y1',
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                                font: {
                                    size: 12
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.datasetIndex === 0) {
                                        label += formatterBRL.format(context.parsed.y);
                                    } else {
                                        label += context.parsed.y + '%';
                                    }
                                    return label;
                                }
                            },
                            backgroundColor: getComputedStyle(document.body).getPropertyValue('--card-bg'),
                            titleColor: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                            bodyColor: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                            borderColor: getComputedStyle(document.body).getPropertyValue('--border-color'),
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary'),
                                maxRotation: 45,
                                minRotation: 45,
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border-color'),
                                drawBorder: false
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Valor (R$)',
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary'),
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return 'R$ ' + (value / 1000000).toFixed(1) + 'M';
                                    }
                                    if (value >= 1000) {
                                        return 'R$ ' + (value / 1000).toFixed(0) + 'K';
                                    }
                                    return 'R$ ' + value;
                                }
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border-color'),
                                drawBorder: false
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Percentual (%)',
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            },
                            grid: {
                                drawOnChartArea: false,
                                drawBorder: false
                            },
                            min: 0,
                            max: Math.max(...campaignPercents) * 1.2
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });

            // Configura√ß√£o do gr√°fico de pizza
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            
            // Destruir gr√°fico anterior se existir
            if (pieChart) {
                pieChart.destroy();
            }
            
            const pieColors = [
                'rgba(59, 130, 246, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(16, 185, 129, 0.8)'
            ];
            
            pieChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: data.categories.map(c => c.name),
                    datasets: [{
                        data: data.categories.map(c => c.percent),
                        backgroundColor: pieColors,
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const valorEquivalente = (value / 100) * data.verba_total;
                                    return `${label}: ${value}% (${formatterBRL.format(valorEquivalente)})`;
                                }
                            },
                            backgroundColor: getComputedStyle(document.body).getPropertyValue('--card-bg'),
                            titleColor: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                            bodyColor: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                            borderColor: getComputedStyle(document.body).getPropertyValue('--border-color'),
                            borderWidth: 1
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000
                    }
                }
            });

            // Atualizar legenda do gr√°fico de pizza
            updatePieLegend();
        }

        // Atualizar legenda do gr√°fico de pizza
        function updatePieLegend() {
            const legend = document.getElementById('pieLegend');
            legend.innerHTML = '';

            const pieColors = [
                'rgba(59, 130, 246, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(16, 185, 129, 0.8)'
            ];

            data.categories.forEach((category, index) => {
                const valorEquivalente = (category.percent / 100) * data.verba_total;
                
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const colorSpan = document.createElement('span');
                colorSpan.className = 'legend-color';
                colorSpan.style.backgroundColor = pieColors[index];
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'legend-name';
                nameSpan.textContent = category.name;
                
                const valueSpan = document.createElement('span');
                valueSpan.className = 'legend-value';
                valueSpan.textContent = `${category.percent}%`;
                
                const brlSpan = document.createElement('span');
                brlSpan.className = 'legend-value';
                brlSpan.textContent = formatterBRL.format(valorEquivalente);
                brlSpan.style.fontSize = '0.85rem';
                brlSpan.style.color = getComputedStyle(document.body).getPropertyValue('--text-secondary');
                
                legendItem.appendChild(colorSpan);
                legendItem.appendChild(nameSpan);
                legendItem.appendChild(valueSpan);
                legendItem.appendChild(brlSpan);
                
                legend.appendChild(legendItem);
            });
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Toggle de tema
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Bot√£o de menu mobile
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('controls').classList.toggle('active');
            });
            
            // Exportar JSON
            document.getElementById('exportJson').addEventListener('click', exportJson);
            
            // Exportar CSV
            document.getElementById('exportCsv').addEventListener('click', exportCsv);
            
            // Exportar PNG
            document.getElementById('exportPng').addEventListener('click', exportPng);
            
            // Copiar JSON
            document.getElementById('copyJson').addEventListener('click', copyJson);
            
            // Pesquisa
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filterTable(e.target.value);
            });
            
            // Ordena√ß√£o da tabela
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', function() {
                    const column = this.getAttribute('data-sort');
                    sortTable(column);
                });
            });
            
            // Atualizar gr√°ficos quando a janela √© redimensionada
            window.addEventListener('resize', function() {
                if (barChart) barChart.resize();
                if (pieChart) pieChart.resize();
            });
        }

        // Alternar tema claro/escuro
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeIcon = document.getElementById('themeIcon');
            themeIcon.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            
            // Atualizar gr√°ficos com novas cores
            if (barChart) {
                barChart.update();
            }
            if (pieChart) {
                pieChart.update();
                updatePieLegend();
            }
        }

        // Filtrar tabela por texto
        function filterTable(searchTerm) {
            if (!searchTerm) {
                filteredCampaigns = [...data.campaigns];
            } else {
                const term = searchTerm.toLowerCase();
                filteredCampaigns = data.campaigns.filter(campaign => 
                    campaign.name.toLowerCase().includes(term)
                );
            }
            
            // Reaplicar ordena√ß√£o atual
            sortTable(currentSort.column, false);
        }

        // Ordenar tabela
        function sortTable(column, updateIcons = true) {
            // Alternar dire√ß√£o se clicar na mesma coluna
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'desc';
            }
            
            // Ordenar os dados
            filteredCampaigns.sort((a, b) => {
                let valA, valB;
                
                if (column === 'name') {
                    valA = a.name.toLowerCase();
                    valB = b.name.toLowerCase();
                } else if (column === 'valor') {
                    valA = a.valor;
                    valB = b.valor;
                } else if (column === 'percent') {
                    valA = parseInt(a.percent) || 0;
                    valB = parseInt(b.percent) || 0;
                }
                
                if (currentSort.direction === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });
            
            // Atualizar √≠cones de ordena√ß√£o
            if (updateIcons) {
                document.querySelectorAll('th i').forEach(icon => {
                    icon.textContent = '';
                });
                
                const currentTh = document.querySelector(`th[data-sort="${column}"] i`);
                currentTh.textContent = currentSort.direction === 'asc' ? '‚Üë' : '‚Üì';
            }
            
            // Renderizar tabela e gr√°fico novamente
            renderTable();
            initializeCharts();
        }

        // Exportar dados como JSON
        function exportJson() {
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'dados_verba.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Exportar dados como CSV
        function exportCsv() {
            const headers = ['Campanha', 'Valor (R$)', 'Percentual'];
            const csvData = data.campaigns.map(campaign => [
                `"${campaign.name}"`,
                campaign.valor,
                campaign.percent
            ]);
            
            const csvContent = [
                headers.join(';'),
                ...csvData.map(row => row.join(';'))
            ].join('\n');
            
            const dataUri = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csvContent);
            
            const exportFileDefaultName = 'dados_verba.csv';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Exportar gr√°fico como PNG
        function exportPng() {
            const link = document.createElement('a');
            link.download = 'grafico_verba.png';
            link.href = document.getElementById('barChart').toDataURL('image/png');
            link.click();
        }

        // Copiar JSON para √°rea de transfer√™ncia
        function copyJson() {
            const dataStr = JSON.stringify(data, null, 2);
            navigator.clipboard.writeText(dataStr).then(() => {
                // Mostrar feedback visual
                const originalText = document.getElementById('copyJson').innerHTML;
                document.getElementById('copyJson').innerHTML = '<span>‚úÖ</span> Copiado!';
                
                setTimeout(() => {
                    document.getElementById('copyJson').innerHTML = originalText;
                }, 2000);
            });
        }
    </script>
</body>
</html>
