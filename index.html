<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Cronograma Diário</title>
   <style>
      body {
         font-family: 'Arial', sans-serif;
       
         margin: 0;
         padding: 80px;
         display: flex;
         flex-direction: column;
         align-items: center;
         justify-content: center;
        
         
background:#008E97;
}


.bgL{
      display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5); /* Fundo escuro semi-transparente */
         justify-content: center;
         align-items: center;
}

.bgL2{
      display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5); /* Fundo escuro semi-transparente */
         justify-content: center;
         align-items: center;
}

.bgL3{
      display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5); /* Fundo escuro semi-transparente */
         justify-content: center;
         align-items: center;
}

.bgL4{
     
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5); /* Fundo escuro semi-transparente */
         justify-content: center;
         align-items: center;
}

.msg{
        width: 300px;
        text-align: center;
         height: 100%;
         max-height: 50px;
         margin: 50px auto;
         background-color: #37a337;
         padding: 20px;
         border-radius: 8px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}
.msg p{
   font-size: 18px;
   color:white;
}


.msgerro{
           width: 300px;
        text-align: center;
         height: 100%;
         max-height: 50px;
         margin: 50px auto;
         background-color: red;
         padding: 20px;
         border-radius: 8px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}

.msgerro p{
   font-size: 18px;
   color:white;
}

.bgconteudo{
         width: 300px;
         height: 100%;
         max-height: 600px;
         margin: 50px auto;
         background-color: #fff;
         padding: 20px;
         border-radius: 8px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
       
}

      .loginbtn{
         text-align: center;
         width: 100%;
         max-width: 150px;
         padding: 15px;
         padding-top:0px;
         height: 30px;
         color: white;
         border: 1px solid white;
         border-radius: 12px;
         background-color: skyblue;
         margin: 0 auto;
         margin-top: 40px;
         cursor: pointer;
  }
.bgconteudolog{

         width: 340px;
         height: 100%;
         max-height: 320px;
         margin: 50px auto;
         background-color: #fff;
         padding: 20px;
         overflow-x: hidden;
         border-radius: 8px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
       
}
.checkdiv{
   text-align: center;
   margin-top: 20px;
   color: #ccc;
}
.check{
   overflow-x: hidden;
   position: relative;
   top: -18px;
   left: 65px;
}


.bgcontentt{
   width: 100%;
   height: 100%;
     overflow: auto;
}


.bgcontentt2{
   width: 100%;
   height: 100%;
     overflow-x: hidden;
}


.btntrocar{
     text-align: center;
         width: 100%;
         max-width: 150px;
         padding: 15px;
         padding-top:0px;
         height: 30px;
         color: black;
         border: 1px solid white;
         border-radius: 12px;
         background-color: #ccc;
         margin: 0 auto;
      margin-top: 10px;
         cursor: pointer;
}

      .container{
        width: 100%;
        border-radius: 10px;
        border: 1px solid rgba(242, 247, 250, 0.8);
         
         height: 100%;
        padding: 20px;
        max-width: 800px;
        min-width: 310px;

}
      h1 {
         color: #f7fcfc;
         text-align: center;
         margin-bottom: 20px;
      }

      input {
         padding: 10px;
         margin-bottom: 10px;
         border: 1px solid #ccc;
         border-radius: 5px;
         font-size: 14px;
         box-sizing: border-box;
         width: 100%;
      }

      .positivo {
         padding: 10px;
         margin-bottom: 10px;
         margin-top: 10px;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         font-size: 14px;
         transition: background-color 0.3s ease;
         background-color: #54fa48;
      }

      .positivo:hover {
         background-color: #20f511;
         color: white;
      }


           .azul {
         padding: 10px;
         margin-bottom: 10px;
         margin-top: 10px;
            margin: 0 auto;
         border: none;
         text-align: center;
         border-radius: 5px;
         cursor: pointer;
         font-size: 14px;
         border: 1px solid white;
         transition: background-color 0.3s ease;
         background-color: #2255f0;
              color: white;
      }

      .azul:hover {
         background-color: #2255f0;
    
      }


        .negativo {
         padding: 10px;
         margin-bottom: 10px;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         font-size: 14px;
         transition: background-color 0.3s ease;
         background-color: #f23535;
      }

      .negativo:hover {
         
         color: white;
      }


      .conluidap{
         color: green;
      }

      ul {
         list-style: none;
         padding: 0;
         margin: 0;
         width: 100%;

         padding-bottom: 10px;
      }

      li {
         background-color: #fff;
         border: 1px solid #ddd;
         border-radius: 5px;
         margin-bottom: 10px;
         padding: 10px;
         display: flex;
         flex-direction: column;
         align-items: flex-start;
         position: relative;

         transition: transform 0.3s ease;
      }

      li.concluida {
         background-color: #d2f7d3;
         border-color: green;

      }

      .descricao-detalhada, .descricao-datacriacao, .descricao-dataconcluida {
         margin-top: 5px;
         color: #777;
      }


            .datac, .statusc, .aproveitamentoc{
         margin-top: 5px;
         color: #777;
      }

      button.deletar {
         background-color: #ff5252;
         color: white;
         margin-top: 10px;
      }

      button.deletar:hover {
         background-color: #ff1744;
      }

      .fechar{
         text-align: center;
         width: 100%;
         max-width: 150px;
         padding: 15px;
         padding-top:0px;
         height: 30px;
         color: white;
         border: 1px solid white;
         border-radius: 12px;
         background-color: #ff4545;
         margin: 0 auto;
      
         cursor: pointer;
  }
      .tarefasconcluidas p {
         color: white;
          font-family: 'Arial', sans-serif;
      }
        .tarefasconcluidas span {
         color: white;
          font-family: 'Arial', sans-serif;
      }


.btnsair{
  text-align: center;
         width: 100%;
         max-width: 150px;
         padding: 15px;
         padding-top:0px;
         height: 30px;
         color: white;
         border: 1px solid white;
         border-radius: 12px;
         background-color: #ff4545;
         margin: 0 auto;
         margin-top: 30px;
         cursor: pointer;
}

.explicacao{
        width: 300px;
        text-align: center;
         height: 100%;
         max-height: 300px;
         margin: 50px auto;
         background-color: #95ecea;
         padding: 20px;
         border-radius: 8px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}
.explicacao p{
   font-size: 18px;
   color:rgb(0, 0, 0);
}

.btnok{
  text-align: center;
         width: 100%;
         max-width: 150px;
         padding: 15px;
         padding-top:24px;
         height: 30px;
         color: white;
         border: 1px solid white;
         border-radius: 12px;
         background-color: #458fff;
         margin: 0 auto;
         margin-top: 1px;
         cursor: pointer;
}


      /*animacoes*/

    /* Animação para pontuação salva */
@keyframes pontuacaoSalvaAnimation {
   0% { opacity: 0; transform: translateY(30px); }
   100% { opacity: 1; transform: translateY(0); }
}

.pontuacaosalva {
   animation: pontuacaoSalvaAnimation 0.5s ease-out;
}

/* Animação para tarefas resetadas */
@keyframes tarefasResetadasAnimation {
   0% { opacity: 0; transform: translateY(30px); }
   100% { opacity: 1; transform: translateY(0); }
}

.tarefasresetadas {
   animation: tarefasResetadasAnimation 0.5s ease-out;
}

/* Animação para tarefa adicionada */
@keyframes tarefaAdicionadaAnimation {
   0% { opacity: 0; transform: translateY(30px); }
   100% { opacity: 1; transform: translateY(0); }
}

.tarefadicionada {
   animation: tarefaAdicionadaAnimation 0.5s ease-out;
}


.carregando {
   z-index: 10;
  
    border: 15px solid #3498db;
    border-top: 15px solid white;
    border-radius: 100%;
    width: 100px;
    height: 100px;
    animation: spin 1s linear infinite;
    margin: 50px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}



      @media (max-width: 600px) {
         li {
            width: 100%;
         }
      }
   </style>
</head>
<body>

<div class="container">
   <h1 id="nomedocara">Cronograma Diário (2024)</h1>



   <input type="text" id="descricaoTarefa" placeholder="Descrição da Tarefa">
   <input type="text" id="descricaoDetalhada" placeholder="Descrição Detalhada">


   <button class="positivo" onclick="fazerRequisicaoPost()">Adicionar Tarefa</button>
   <button class="negativo" onclick="resetarTarefas()">Resetar Tarefas</button>
    <button class="azul" onclick="abrirhistoicodiario()">Histórico diário</button>

    <div class="tarefasconcluidas">
      <p id="infoTarefasConcluidas">Tarefas concluídas: <span id="concluidasCount">0</span>/<span id="totalTarefas">0</span></p>
   </div>


   <ul id="listaTarefas"></ul>

    <button class="azul" onclick="salvarpontuacao()">Salvar pontuação do dia</button>
</div><!---container-->

<div class="btnsair" onclick="sair()">
   
   <p>sair</p>

</div>





<div id="bgLid" class="bgL">
  
   <div class="bgconteudo">

         <div class="bgcontentt">
              <ul id="historicodiario"></ul>
         </div>
       


          <div class="fechar" onclick="fecharhistoicodiario()">
             <p>Fechar Histórico</p>

          </div>
   </div>
</div>



<div id="bgloginid" class="bgL2">
  
   <div class="bgconteudolog">

         <div class="bgcontentt2">
              <input type="text" id="nomeuser" placeholder="Nome: ">
               <input type="text" id="senhauser" placeholder="Senha: ">


                  <div class="checkdiv">
                     
                      <label for="myCheckbox">Lembrar de mim</label>
                                 <input type="checkbox" id="myCheckbox" class="check" onchange="verificarCheckbox()">


                  </div>
              


                 <div class="loginbtn" onclick="login()">
             <p>LOGAR</p>
          </div>
           <div class="btntrocar" onclick="irpc()">
             <p>realizar cadastro</p>
          </div>
         </div>
       

        
   </div>
</div>

<div id="cadastroid" class="bgL3">
  
   <div class="bgconteudolog">

         <div class="bgcontentt">
               <input type="text" id="nomeuserc" placeholder="Nome: ">
               <input type="text" id="senhauserc" placeholder="Senha: ">

                  <div class="loginbtn" onclick="cadastro()">
             <p>CADASTRAR</p>
          </div>
           <div class="btntrocar" onclick="irpl()">
             <p>realizar login</p>
          </div>
         </div>
       

       
   </div>
</div>


<!--mensagens-->
<div id="bgLidpont" class="bgL">
  
   <div class="msg">

             <p>Pontuação salva com sucesso!</p>
   </div>
</div>


<div id="carregandoid" class="bgL4">
  
   <div class="carregando">

   </div>
</div>




<div id="usuariocadastradoid" class="bgL">
  
   <div class="explicacao">

      <p>Esse é um cronograma diário para se organizar em relaçao a tarefas do dia a dia</p>
   
      <p>Aqui voce pode criar tarefas, excluir, marcar como concluídas e reseta-las manualmente. Ao final do dia todas as suas tarefas só resetadas e sua pontuacao é salva automaticamente.</p>
   
      <p>Voce tambem pode salvar sua pontuacao manualmente quantas vezes quiser</p>
   
   </div>
   <div class="btnok" onclick="fecharmodalexplica()">
      OK
   </div>

</div>


<div id="bgLidreset" class="bgL">
  
   <div class="msg">

             <p>Tarefas resetadas!</p>
   </div>
</div>


<div id="errologin" class="bgL">
  
   <div class="msgerro">

             <p>Usuário não encontrado</p>
   </div>
</div>



   <script>

carregando()


//---------------------variaveis globais--------------------

   var user = null;
   var total = 0;
   var concluidas = 0;
   var tarefasr = null;
   var datacomparativa = 0;
   var historicoporid = [];
   var jatem = false;
   var naotem = false;


 //location.reload();

function diario(){




   
   var dataatual = new Date().toISOString()

   dataatual = formatarData(dataatual)

   var datacriacao = formatarData(datacomparativa.dataCriacao)



   console.log(dataatual[1])

   console.log(datacriacao[1])

   //var dataatual = 8

   if(dataatual[1] > datacriacao[1] ){
       setTimeout(function() {
         salvarpontuacaosemanima()
         console.log("salvarp")
        },100)

         setTimeout(function() {
           resetarTarefassemanima()
            console.log("resetart")
        },3000)
   }else{
      console.log("prazo")
   }

}




function irpl(){
   var bgllogin = document.getElementById('bgloginid');
      bgllogin.style.display = "initial"
   var cadastro = document.getElementById('cadastroid');
      cadastro.style.display = "none"
}
function irpc(){
   var bgllogin = document.getElementById('bgloginid');
      bgllogin.style.display = "none"
   var cadastro = document.getElementById('cadastroid');
      cadastro.style.display = "initial"
}


   //------------------------------funcoes usuario----------------------------------



function verificarCheckbox() {
    // Obter a referência do elemento checkbox
    var checkbox = document.getElementById("myCheckbox");


   var nome = document.getElementById('nomeuser').value
   var senha = document.getElementById('senhauser').value


    // Verificar se a checkbox está marcada
    if (checkbox.checked) {
        localStorage.setItem('nome', nome);
          localStorage.setItem('senha', senha);

         
    } else {
        
    }
}


  function sair() {
         // Remove os itens armazenados no localStorage
         localStorage.removeItem('nome');
         localStorage.removeItem('senha');

         

          location.reload();
      }



if(localStorage.getItem('nome') && localStorage.getItem('nome')){
      var nome = localStorage.getItem('nome');
      var senha = localStorage.getItem('senha');
      getusuarios(nome, senha)

       setTimeout(function() {
            if(user){
               carregando()

                  fazerRequisicaoGet(user.id);

                  

                  document.getElementById("nomedocara").innerHTML = "Cronograma Diário " + nome + " (2024)";

                  setTimeout(function() {

                        diario()

                     }, 1000);


                      setTimeout(function() {

                        var bgllogin = document.getElementById('bgloginid');
                        bgllogin.style.display = "none"

                     }, 1000);


               }
       },400)
   

   }else{
       var bgllogin = document.getElementById('bgloginid');
                  bgllogin.style.display = "initial"
   }




function login(){


   var nome = document.getElementById('nomeuser').value
      var senha = document.getElementById('senhauser').value
      
      getusuarios(nome, senha)
     setTimeout(function() {

         if(user){
            carregando()

                  fazerRequisicaoGet(user.id);

               
                  document.getElementById("nomedocara").innerHTML = "Cronograma Diário " + nome + " (2024)";

                  setTimeout(function() {

                        diario()

                     }, 1000);


                      setTimeout(function() {

                        var bgllogin = document.getElementById('bgloginid');
                        bgllogin.style.display = "none"

                     }, 1000);


         }else{

             var errologins = document.getElementById('errologin');
              errologins.style.display = "initial"

            setTimeout(function() {

               errologins.style.display = "none"
            }, 2000);
           
   }

      }, 1000);


  
}

function cadastro(){
    var xhr = new XMLHttpRequest();
         xhr.open('POST', 'https://appatividades-7450d-default-rtdb.firebaseio.com/usuarios.json', true);
         xhr.setRequestHeader('Content-Type', 'application/json');
         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
               
               
            }
         };

         var novaTarefa = {
           nome: document.getElementById('nomeuserc').value,
           senha: document.getElementById('senhauserc').value,
         };

         xhr.send(JSON.stringify(novaTarefa));


         usercadastrado()

        
}








function getusuarios(nome, senha) {
   var xhr = new XMLHttpRequest();
   xhr.open('GET', 'https://appatividades-7450d-default-rtdb.firebaseio.com/usuarios.json', true);
   xhr.onreadystatechange = function () {
      if (xhr.readyState == 4 && xhr.status == 200) {
         var usuario = JSON.parse(xhr.responseText);
         var users = [];
         
         // Itera sobre cada chave (ID) no objeto
         for (var id in usuario) {
            // Verifica se a descrição é igual ao parâmetro
            if (usuario[id].nome === nome && usuario[id].senha === senha) {
               // Adiciona o ID ao objeto da tarefa
               user = usuario[id];
               user.id = id;
               users.push(user);
            }
         }

         // Exibe as tarefas encontradas
         
      }
   };
   xhr.send();
}





// function buscarTarefaPorDescricao(descricao) {
//    var xhr = new XMLHttpRequest();
//    xhr.open('GET', 'https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas.json', true);
//    xhr.onreadystatechange = function () {
//       if (xhr.readyState == 4 && xhr.status == 200) {
//          var tarefasr = JSON.parse(xhr.responseText);
//          var tarefasEncontradas = [];

//          // Itera sobre cada chave (ID) no objeto
//          for (var id in tarefasr) {
//             // Verifica se a descrição é igual ao parâmetro
//             if (tarefasr[id].descricao === descricao) {
//                // Adiciona o ID ao objeto da tarefa
//                var tarefaEncontrada = tarefasr[id];
//                tarefaEncontrada.id = id;
//                tarefasEncontradas.push(tarefaEncontrada);
//             }
//          }

//          // Exibe as tarefas encontradas
//          console.log(tarefasEncontradas);
//       }
//    };
//    xhr.send();
// }




   //------------------------------funcoes animacoes-----------------------------------
function pontsalva() {

       var bgLpont = document.getElementById('bgLidpont')
        bgLpont.style.display = "initial"

   // Remove o elemento após a animação
   setTimeout(function() {
  ;      bgLpont.style.display = "none"
   }, 2000); // Ajuste o tempo conforme necessário
}

function carregando() {

       var carregando = document.getElementById('carregandoid')
        carregando.style.display = "initial"

   // Remove o elemento após a animação
   setTimeout(function() {
        carregando.style.display = "none"
   }, 3000); // Ajuste o tempo conforme necessário
}

function usercadastrado() {

       var usuariocadastrado = document.getElementById('usuariocadastradoid')
        usuariocadastrado.style.display = "initial"


}
function fecharmodalexplica(){
   var usuariocadastrado = document.getElementById('usuariocadastradoid')
        usuariocadastrado.style.display = "none"
        location.reload();

}


function tarefaresetadas() {

       var bgLreset = document.getElementById('bgLidreset')
        bgLreset.style.display = "initial"

   // Remove o elemento após a animação
   setTimeout(function() {
  ;      bgLreset.style.display = "none"
   }, 2000); // Ajuste o tempo conforme necessário
}





   //------------------------------funcoes tarefas-----------------------------------


      function fazerRequisicaoGet() {

         userId = user.id
         var xhr = new XMLHttpRequest();
         xhr.open('GET', 'https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas.json', true);
         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {

               if(tarefasr){
                  
                  tarefasr = JSON.parse(xhr.responseText);
               }else{
                   
                  tarefasr = JSON.parse(xhr.responseText);
               }

         
         var tarefasEncontradas = [];

         // Itera sobre cada chave (ID) no objeto
         for (var id in tarefasr) {
            // Verifica se a descrição é igual ao parâmetro
            if (tarefasr[id].userId === userId) {
               // Adiciona o ID ao objeto da tarefa
               var tarefaEncontrada = tarefasr[id];
               tarefaEncontrada.id = id;
               tarefasEncontradas.push(tarefaEncontrada);
            }
         }

         // Exibe as tarefas encontradas
        

               datacomparativa = tarefasEncontradas[0]
               exibirTarefas(tarefasEncontradas);
               
            }
         };
         xhr.send();
      };

     



      function exibirTarefas(tarefas) {
      
         var infoTarefasConcluidas = document.getElementById('infoTarefasConcluidas');
         var concluidasCount = document.getElementById('concluidasCount');
         var totalTarefasElement = document.getElementById('totalTarefas');




         var listaTarefas = document.getElementById('listaTarefas');
         listaTarefas.innerHTML = ''; // Limpa a lista para evitar duplicatas

         var tarefasConcluidas = 0;
         var totalTarefas = 0;

         for (var id in tarefas) {
            var tarefa = tarefas[id];

            

              totalTarefas++;
            var itemLista = document.createElement('li');
          
            var botaoDeletar = document.createElement('button');

       

            //  setTimeout(function() {
               
            // }, 2000);


            if (!tarefa.concluida) {
            var botaoConcluir = document.createElement('button');

               botaoConcluir.classList.add('positivo');
                botaoDeletar.classList.add('negativo');
               // Adiciona o botão "Concluir" apenas para tarefas não concluídas
               botaoConcluir.textContent = 'Concluir';
               botaoConcluir.addEventListener('click', (function(id) {
                  return function() {
                     marcarComoConcluida(id); 
                    

                  };
               })(tarefa.id));

            } else {
               tarefasConcluidas++;
                var botaoConcluir = document.createElement('p');
                botaoConcluir.textContent = "Concluída!";
                botaoConcluir.classList.add('conluidap');

                botaoDeletar.classList.add('negativo');
               // Adiciona a classe 'concluida' para tarefas concluídas
               itemLista.classList.add('concluida');
            }


            // Adiciona o botão "Deletar" para todas as tarefas
            botaoDeletar.textContent = 'Deletar';
            botaoDeletar.addEventListener('click', (function(id) {
               return function() {
                  deletarTarefa(id); // Chama a função para deletar a tarefa ao clicar no botão
               };
            })(tarefa.id));



            var descricao = document.createElement('div');
            descricao.textContent = tarefa.descricao;

             var descricaoDetalhada = document.createElement('div');
         descricaoDetalhada.textContent = tarefa.descricaoDetalhada || ''; // Exibe a descrição detalhada se existir

         var datacriacao = document.createElement('div');
         datacriacao.textContent = tarefa.dataCriacao
            ? `Data de criação: ${formatarData(tarefa.dataCriacao)}`
            : ''; // Exibe a descrição detalhada se existir

         var dataconluida = document.createElement('div');
         dataconluida.textContent = tarefa.dataConclusao
            ? `Data de Conclusão: ${formatarData(tarefa.dataConclusao)}`
            : ''; // Exibe a descrição detalhada se existir 



            descricaoDetalhada.classList.add('descricao-detalhada');
            datacriacao.classList.add('descricao-datacriacao');
            dataconluida.classList.add('descricao-dataconluida');

            itemLista.appendChild(descricao);
            itemLista.appendChild(descricaoDetalhada);
            itemLista.appendChild(datacriacao);
            itemLista.appendChild(dataconluida);
            itemLista.appendChild(botaoConcluir);
            itemLista.appendChild(botaoDeletar);
            listaTarefas.appendChild(itemLista);


               concluidasCount.textContent = tarefasConcluidas;
         totalTarefasElement.textContent = totalTarefas;

            total = totalTarefas
            concluidas = tarefasConcluidas
         }
      }


      function testezinho(id){
         console.log(id)
      }




      function formatarData(dataString) {

        

         const options = { year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric' };
         return new Date(dataString).toLocaleDateString('pt-BR', options);
      }


      function fazerRequisicaoPost() {

         var xhr = new XMLHttpRequest();
         xhr.open('POST', 'https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas.json', true);
         xhr.setRequestHeader('Content-Type', 'application/json');
         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
               
                  setTimeout(function() {
                     fazerRequisicaoGet();
                   }, 1000); 
                
            }
         };

         var novaTarefa = {
            descricao: document.getElementById('descricaoTarefa').value,
            descricaoDetalhada: document.getElementById('descricaoDetalhada').value,
            concluida: false,
            dataCriacao: new Date().toISOString(), // Adiciona a data de criação no formato ISO8601
            dataConclusao: null, // Inicializa a data de conclusão como null
            userId: user.id,
         };

         xhr.send(JSON.stringify(novaTarefa));
      };






function marcarComoConcluida(tarefaId) {
   
console.log(tarefaId)
   var xhr = new XMLHttpRequest();
   var url = `https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas/${tarefaId}.json`;

   xhr.open('PATCH', url, true);
   xhr.setRequestHeader('Content-Type', 'application/json');
   xhr.onreadystatechange = function () {
      if (xhr.readyState == 4) {
         if (xhr.status == 200) {
            console.log('Tarefa marcada como concluída com sucesso!');

            setTimeout(function() {
               fazerRequisicaoGet();
            }, 1000);
         } else {
            console.error('Erro ao marcar como concluída:', xhr.status, xhr.statusText);
         }
      }
   };

   var dataConclusao = new Date().toISOString();
   xhr.send(JSON.stringify({ concluida: true, dataConclusao: dataConclusao }));
}







      function deletarTarefa(tarefaId) {

         

         var xhr = new XMLHttpRequest();
         var url = `https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas/${tarefaId}.json`;

         xhr.open('DELETE', url, true);
         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
               if (xhr.status == 200) {
                  

                    setTimeout(function() {
                     fazerRequisicaoGet();
                   }, 1000); 
                 // Após deletar, atualiza a lista de tarefas

               } else {
                  console.error('Erro ao deletar tarefa:', xhr.status, xhr.statusText);
               }
            }
         };

         xhr.send();
      }

      function resetarTarefas() {

         //aqui falta mnudar para ele resetar so as do usuario

         var xhr = new XMLHttpRequest();
         var url = 'https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas.json';
         xhr.open('GET', url, true);
         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {

               // Itera sobre todas as tarefas e redefine concluída como false
               for (var id in tarefasr) {
                  nid = tarefasr[id].id
                  
                  atualizarStatusConcluida(nid, false);
               }

               setTimeout(function() {
                  tarefaresetadas()
                  fazerRequisicaoGet();
               }, 1000);
                             

               
                // Atualiza a lista de tarefas
              

            }
         };
         xhr.send();
      }



      function resetarTarefassemanima() {

         //aqui falta mnudar para ele resetar so as do usuario

         var xhr = new XMLHttpRequest();
         var url = 'https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas.json';
         xhr.open('GET', url, true);
         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {

               // Itera sobre todas as tarefas e redefine concluída como false
               for (var id in tarefasr) {
                  nid = tarefasr[id].id
                  
                  atualizarStatusConcluida(nid, false);
               }

               setTimeout(function() {
                  
                  fazerRequisicaoGet();
               }, 1000);
                             

               
                // Atualiza a lista de tarefas
              

            }
         };
         xhr.send();
      }






      function atualizarStatusConcluida(tarefaId, novoStatus) {
          var dataCriacao = new Date().toISOString();
         var xhr = new XMLHttpRequest();
         //console.log(tarefaId)
         var url = `https://appatividades-7450d-default-rtdb.firebaseio.com/tarefas/${tarefaId}.json`;
         xhr.open('PATCH', url, true);
         xhr.setRequestHeader('Content-Type', 'application/json');

         xhr.send(JSON.stringify({

               concluida: novoStatus,
               dataConclusao: null,
               dataCriacao: dataCriacao,


            }));

      };









   //------------------------------funcoes histrico diario-----------------------------------

      function abrirhistoicodiario(){
        var bgL = document.getElementById('bgLid')
        bgL.style.display = "initial"

      
            fazerRequisicaoGetpontuacao();
       
       
        

      }
      function fecharhistoicodiario(){
        var bgL = document.getElementById('bgLid')
        bgL.style.display = "none"

      }




      function exibirHistorico(historico){

         var historicodiario = document.getElementById('historicodiario');
         historicodiario.innerHTML = ''; // Limpa a lista para evitar duplicatas

         for (var id in historico) {

            var historicos = historico[id];
            
            var itemLista = document.createElement('li');
         

         var data = document.createElement('div');
         data.textContent = `Data: ${formatarData(historicos.data)}`
      
         var aproveitamento = document.createElement('div');
         aproveitamento.textContent = `Aproveitamento: ${historicos.aproveitamento}`

         var status = document.createElement('div');
         status.textContent = `Tarefas concluídas no dia: ${ historicos.status}`;


         data.classList.add('datac');
         status.classList.add('statusc');
         aproveitamento.classList.add('aproveitamentoc');


         itemLista.appendChild(status);
         itemLista.appendChild(aproveitamento);
         itemLista.appendChild(data);

         historicodiario.appendChild(itemLista);

         }
      }


         function fazerRequisicaoGetpontuacao() {
         var xhr = new XMLHttpRequest();
         xhr.open('GET', 'https://appatividades-7450d-default-rtdb.firebaseio.com/hisotico.json', true);
         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
               var historico = JSON.parse(xhr.responseText);
               

                  var hisotricoEncontradas = [];

                  // Itera sobre cada chave (ID) no objeto
                  for (var id in historico) {
                     // Verifica se a descrição é igual ao parâmetro
                     if (historico[id].userId === user.id) {
                        // Adiciona o ID ao objeto da tarefa
                        var pontuacao = historico[id];
                        pontuacao.id = id
                     
                        hisotricoEncontradas.push(pontuacao);
                     }
                  }

                  // Exibe as tarefas encontradas
                 



                    setTimeout(function() {
                   
                    exibirHistorico(hisotricoEncontradas);
                    historicoporid = hisotricoEncontradas
                     }, 700);

              
            }
         };
         xhr.send()
       
      };



        function salvarpontuacao(){ 
      
            fazerRequisicaoGetpontuacao()   
            
            pontsalva()

            //settimeout aquis
            setTimeout(function() {

            var aproveitamento = (concluidas/total) * 100
            var aproveitamento = parseInt(aproveitamento.toFixed(0));


               var datahj = new Date().toISOString()

               datahj = formatarData(datahj)
            
               var partes = datahj.split(", ");
               var dataString = partes[0];

               console.log(dataString);



                  for (var id in historicoporid) {
                           console.log(historicoporid)
                           // Verifica se a descrição é igual ao parâmetro

                           var dat = historicoporid[id].data

                           dat = formatarData(dat)

                           var partes2 = dat.split(", ");
                           var dataString2 = partes2[0];

                           console.log(dataString2);


                              if (dataString2 === dataString) {

                              console.log("jatem re")
                              console.log(historicoporid[id].id)

                                 var dataCriacao = new Date().toISOString();

                                 
                                 //

                                 var xhr = new XMLHttpRequest();
                                 var url = `https://appatividades-7450d-default-rtdb.firebaseio.com/hisotico/${historicoporid[id].id}.json`;
                                 
                                 xhr.open('PATCH', url, true);
                                 xhr.setRequestHeader('Content-Type', 'application/json');

                                 xhr.send(JSON.stringify({

                                 data: new Date().toISOString(),
                                 status: concluidas,
                                 aproveitamento: `${aproveitamento}%`,
                                 userId: user.id,



                              }));

                              jatem = true;

                              }else{
                                                      
                                 
                              }
                     }

                     setTimeout(function() {

                        if(!jatem){

                           console.log("naotem ainda em papai")
                              
                              var xhr = new XMLHttpRequest();
                              xhr.open('POST', 'https://appatividades-7450d-default-rtdb.firebaseio.com/hisotico.json', true);
                              xhr.setRequestHeader('Content-Type', 'application/json');
                              xhr.onreadystatechange = function () {
                                 if (xhr.readyState == 4 && xhr.status == 200) {
                                    
                                 }
                              };
            
                              var novohistorico = {
                                 data: new Date().toISOString(),
                                 status: concluidas,
                                 aproveitamento: `${aproveitamento}%`,
                                 userId: user.id,
                              };
            
                              xhr.send(JSON.stringify(novohistorico));
                           }

                     }, 3000)

                  },1000)
               }



             



         function salvarpontuacaosemanima(){
             //aqui falta fazer um get que vai verificar se ja existe aquela data cadastrada para essse usuario no historico, se ja existir ele nao ataliza nada, so da o reset e boa
             var datahj2 = new Date().toISOString()
             datahj2 = formatarData(datahj2)
            var partes3 = datahj2.split(", ");
            var dataString3 = partes3[0];

            console.log(dataString3);

             for (var id in historicoporid) {

               var dat2 = !historicoporid[id].data
               dat2 = formatarData(dat2)
               var partes4 = dat2.split(", ");
               var dataString4 = partes4[0];

                     // Verifica se a descrição é igual ao parâmetro
                     if (dataString4 != dataString3) {
                           naotem = true;
                           console.log("naotem ativado!")
                     }

               }



               setTimeout(function() {
                  if(naotem){
                           var aproveitamento = (concluidas/total) * 100
                           var aproveitamento = parseInt(aproveitamento.toFixed(0));

                           var xhr = new XMLHttpRequest();
                           xhr.open('POST', 'https://appatividades-7450d-default-rtdb.firebaseio.com/hisotico.json', true);
                           xhr.setRequestHeader('Content-Type', 'application/json');
                           xhr.onreadystatechange = function () {
                           if (xhr.readyState == 4 && xhr.status == 200) {
                              
                           }
                           };



                           const resultado = getDiaAnterior();
                     

                           var novohistorico = {
                           data: resultado,
                           status: concluidas,
                           aproveitamento: `${aproveitamento}%`,
                           userId: user.id,
                           };

                           xhr.send(JSON.stringify(novohistorico));
                     }
                   }, 1000); 

         }   






        function getDiaAnterior() {
           // Obter a data atual
           const dataAtual = new Date();

           // Subtrair um dia da data atual
           const diaAnterior = new Date(dataAtual);
           diaAnterior.setDate(dataAtual.getDate() - 1);

           // Ajustar as horas para 00:00:00
           diaAnterior.setHours(0, 0, 0, 0);

           // Formatar a data no formato desejado
           const formatoDesejado = diaAnterior.toISOString();

           return formatoDesejado;
         }

   </script>
</body>
</html>
